

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Component runtime customization &mdash; pyleus 0.3.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="pyleus 0.3.0 documentation" href="index.html"/>
        <link rel="next" title="Tune topology parallelism" href="parallelism.html"/>
        <link rel="prev" title="Output streams and groupings" href="grouping.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> pyleus</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Write your first topology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#organize-your-files">Organize your files</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#define-the-topology-layout">Define the topology layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#write-your-first-spout">Write your first spout</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#write-your-first-bolt">Write your first bolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#run-your-topology">Run your topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reliability.html">Guaranteeing message processing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reliability.html#track-tuples-in-your-spout">Track tuples in your Spout</a></li>
<li class="toctree-l2"><a class="reference internal" href="reliability.html#anchor-tuples-in-your-bolt">Anchor tuples in your Bolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="reliability.html#tune-your-topology">Tune your topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="grouping.html">Output streams and groupings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="grouping.html#single-output-streams">Single output streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="grouping.html#multiple-output-streams">Multiple output streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="grouping.html#available-stream-groupings">Available stream groupings</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Component runtime customization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pass-options-to-components">Pass options to components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#access-component-configuration-and-context">Access component configuration and context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-component-at-startup">Setup component at startup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parallelism.html">Tune topology parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="tick.html">Timing using tick tuples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tick.html#configure-tick-tuples-interval-for-a-component">Configure tick tuples interval for a component</a></li>
<li class="toctree-l2"><a class="reference internal" href="tick.html#simplebolt-tick-tuple-api">SimpleBolt tick tuple API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="logging.html#topology-level-configuration">Topology level configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="yaml.html">Topology definition YAML syntax</a><ul>
<li class="toctree-l2"><a class="reference internal" href="yaml.html#topology-level-options">Topology level options</a></li>
<li class="toctree-l2"><a class="reference internal" href="yaml.html#component-level-options">Component level options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#specify-your-storm-path">Specify your Storm path</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#configuration-file-example">Configuration file example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#manual-testing">Manual testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#repo-organization">Repo organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#versioning">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#development-tips">Development tips</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="storm/storm.html">pyleus.storm</a></li>
<li class="toctree-l2"><a class="reference internal" href="storm/component.html">pyleus.storm.component</a></li>
<li class="toctree-l2"><a class="reference internal" href="storm/spout.html">pyleus.storm.spout</a></li>
<li class="toctree-l2"><a class="reference internal" href="storm/bolt.html">pyleus.storm.bolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="json_fields_bolt.html">pyleus.json_fields_bolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">pyleus.testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="exception.html">pyleus.exception</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">pyleus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Component runtime customization</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/options.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="component-runtime-customization">
<span id="options"></span><h1>Component runtime customization<a class="headerlink" href="#component-runtime-customization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pass-options-to-components">
<h2>Pass options to components<a class="headerlink" href="#pass-options-to-components" title="Permalink to this headline">¶</a></h2>
<p>It is possible to pass options to pyleus components through the topology definition YAML file.</p>
<p>This is how to define options in the YAML:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">spout</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">my_spout_with_options</span>
        <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">my_topology.spout_with_options</span>
        <span class="l-Scalar-Plain">options</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">word</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bird</span>
</pre></div>
</div>
<p>While this is how to declare and refer to them in components:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SpoutWithOptions</span><span class="p">(</span><span class="n">Spout</span><span class="p">):</span>

    <span class="n">OUTPUT_FIELDS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">]</span>
    <span class="n">OPTIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;word&#39;</span><span class="p">]</span>

 <span class="k">def</span> <span class="nf">next_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">((</span><span class="s">&quot;I am a stupid &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;word&#39;</span><span class="p">],))</span>
</pre></div>
</div>
<p>You can access options at any time through the <tt class="docutils literal"><span class="pre">self.options</span></tt> dictionary.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You do not need to specify in the YAML all options declared in the component, but accessing not specified options will raise an error.</p>
<p class="last">Conversely, passing options which have not been defined in the component through the YAML file will prevent your topology from building. You can think to components as functions where you define optional arguments (options) and to the YAML file as the code calling them.</p>
</div>
</div>
<div class="section" id="access-component-configuration-and-context">
<h2>Access component configuration and context<a class="headerlink" href="#access-component-configuration-and-context" title="Permalink to this headline">¶</a></h2>
<p>It is worth noting that you have access to a copy of Storm configuration and context for each component. You can access them at any time through <tt class="docutils literal"><span class="pre">self.conf</span></tt> and <tt class="docutils literal"><span class="pre">self.context</span></tt> dictionaries like in the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">topology_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;storm.id&#39;</span><span class="p">]</span>
<span class="n">taskid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;taskid&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>While the content of <tt class="docutils literal"><span class="pre">self.conf</span></tt> is rather easy to imagine, <tt class="docutils literal"><span class="pre">self.context</span></tt> contains information like the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;task-&gt;component&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;__acker&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;my-spout&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;my-bolt&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;another-bolt&#39;</span><span class="p">},</span> <span class="s">&#39;taskid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-component-at-startup">
<h2>Setup component at startup<a class="headerlink" href="#setup-component-at-startup" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it could be useful to perform some setup actions <em>before</em> your component starts receiving tuples, but <em>after</em> Storm configuration and context have been loaded and options have been parsed.</p>
<p>You can implement the <a class="reference internal" href="storm/component.html#pyleus.storm.component.Component.initialize" title="pyleus.storm.component.Component.initialize"><tt class="xref py py-meth docutils literal"><span class="pre">initialize()</span></tt></a> method, like in the example below, to achieve the same behavior:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FileSpout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">OPTIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">],</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">You can find several examples on <cite>GitHub</cite>.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallelism.html" class="btn btn-neutral float-right" title="Tune topology parallelism"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="grouping.html" class="btn btn-neutral" title="Output streams and groupings"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013–2014 Yelp.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>